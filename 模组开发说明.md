# pvzclass模组开发说明

我打算基于pvzclass开发一个模组加载器，实现将多个pvzclass代码组合起来使用，以解决多个exe文件之间的冲突等问题。当然模组加载器是一个复杂的工作，鄙人能力不足，权当抛砖引玉。预计的开发路线如下：

- [x] 模组的加载
- [x] 普通pvzclass方法的支持
- [ ] event组件的支持
- [ ] 模组资源（如pak）的管理
- [ ] 代码注入的管理
- [ ] 更友好的模组加载界面
- [ ] 创意工坊

## 快速上手

相比之前的版本，解决方案中现在有pvzclass和mod两个项目，你不再需要在pvzclass项目中进行开发，你只需要修改mod项目即可。`framework.h`和`dllmain.cpp`文件是Visual Studio自动生成的，无需修改。

在`pch.h`中，你需要创建一个`Mod`类的子类，一个最简单的版本如下：

```cpp
class ExampleMod : public Mod
{
public:
    ExampleMod();
    void onLoad(DWORD pid, HANDLE hprocess, HWND mainwindowhandle, int Variable, DWORD mainThreadId, HANDLE hThread);
    void update();
    void onFree();
};
```

也就是说，除了构造函数，你需要实现`Mod`类中的抽象方法，其中`onLoad`会在模组加载时调用，`update`会持续调用，`onFree`会在模组卸载时调用。

**该文件中的其余内容不需要修改，除非你知道你自己在做什么。**

在`pch.cpp`中，你需要对头文件中的定义给出实现，这个不需要我说明太多，直接看代码会更快上手。

## 编译与使用

一切完成后，生成解决方案，它会首先生成pvzclass，然后为其创建lib文件，再去生成mod。在pvzclass.exe的同级目录下创建mods文件夹，并将生成的mod复制进去，启动pvzclass.exe，即可成功加载mod。

生成lib文件的参考：[How do I create both a .lib file and an .exe file in Visual C++? - Stack Overflow](https://stackoverflow.com/questions/2658215/how-do-i-create-both-a-lib-file-and-an-exe-file-in-visual-c)
